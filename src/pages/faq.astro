---
import { getCollection, type CollectionEntry } from 'astro:content';
import FAQ from '../components/Faq.astro';
import Layout from '../layouts/Layout.astro';
import config from '../../astro.config.mjs';

const defaultLocale = config.i18n?.defaultLocale || 'en';
const faq = await getCollection('faq', ({ id }) => {
    return id.startsWith(`${defaultLocale}/`);
});

type FaqItem = CollectionEntry<'faq'>;
// Object.groupBy returns a Partial<Record> which we convert to Record with a default empty array
const groupedPartial = Object.groupBy(
    faq,
    (item: FaqItem) => item.data.category,
);
const grouped = groupedPartial as Record<string, FaqItem[]>;
---

<Layout>
    <FAQ data={grouped} />
</Layout>

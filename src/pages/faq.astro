---
import { getCollection, type CollectionEntry } from 'astro:content';
import * as m from '@/paraglide/messages.js';
import FAQ from '@theme/Faq.astro';
import Layout from '@theme/Layout.astro';
import config from '@/config';

const defaultLocale = config.defaultLanguage || 'en';
const faq = await getCollection('faq', ({ id }) => {
    return id.startsWith(`${defaultLocale}/`);
});

type FaqItem = CollectionEntry<'faq'>;
// Object.groupBy returns a Partial<Record> which we convert to Record with a default empty array
const groupedPartial = Object.groupBy(
    faq,
    (item: FaqItem) => item.data.category,
);
const grouped = groupedPartial as Record<string, FaqItem[]>;
---

<Layout title={m.faqNav()}>
    <FAQ data={grouped} />
</Layout>
